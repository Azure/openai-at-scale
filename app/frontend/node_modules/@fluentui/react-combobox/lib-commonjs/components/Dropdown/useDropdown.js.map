{"version":3,"sources":["../../../lib/components/Dropdown/useDropdown.js"],"sourcesContent":["import * as React from 'react';\nimport { ChevronDownRegular as ChevronDownIcon } from '@fluentui/react-icons';\nimport { getPartitionedNativeProps, mergeCallbacks, resolveShorthand, useTimeout } from '@fluentui/react-utilities';\nimport { getDropdownActionFromKey } from '../../utils/dropdownKeyActions';\nimport { useComboboxBaseState } from '../../utils/useComboboxBaseState';\nimport { useComboboxPopup } from '../../utils/useComboboxPopup';\nimport { useTriggerListboxSlots } from '../../utils/useTriggerListboxSlots';\nimport { Listbox } from '../Listbox/Listbox';\nimport { useMergedRefs } from '@fluentui/react-utilities';\n/**\n * Create the state required to render Dropdown.\n *\n * The returned state can be modified with hooks such as useDropdownStyles_unstable,\n * before being passed to renderDropdown_unstable.\n *\n * @param props - props from this instance of Dropdown\n * @param ref - reference to root HTMLElement of Dropdown\n */\nexport const useDropdown_unstable = (props, ref) => {\n  const baseState = useComboboxBaseState(props);\n  const {\n    activeOption,\n    getIndexOfId,\n    getOptionsMatchingText,\n    open,\n    setActiveOption,\n    setFocusVisible,\n    setOpen\n  } = baseState;\n  const {\n    primary: triggerNativeProps,\n    root: rootNativeProps\n  } = getPartitionedNativeProps({\n    props,\n    primarySlotTagName: 'button',\n    excludedPropNames: ['children']\n  });\n  // set listbox popup width based off the root/trigger width\n  const rootRef = React.useRef(null);\n  const [popupWidth, setPopupWidth] = React.useState();\n  React.useEffect(() => {\n    var _rootRef_current;\n    const width = open ? `${(_rootRef_current = rootRef.current) === null || _rootRef_current === void 0 ? void 0 : _rootRef_current.clientWidth}px` : undefined;\n    setPopupWidth(width);\n  }, [open]);\n  // jump to matching option based on typing\n  const searchString = React.useRef('');\n  const [setKeyTimeout, clearKeyTimeout] = useTimeout();\n  const getNextMatchingOption = () => {\n    // first check for matches for the full searchString\n    let matcher = optionText => optionText.toLowerCase().indexOf(searchString.current) === 0;\n    let matches = getOptionsMatchingText(matcher);\n    let startIndex = activeOption ? getIndexOfId(activeOption.id) : 0;\n    // if the dropdown is already open and the searchstring is a single character,\n    // then look after the current activeOption for letters\n    // this is so slowly typing the same letter will cycle through matches\n    if (open && searchString.current.length === 1) {\n      startIndex++;\n    }\n    // if there are no direct matches, check if the search is all the same letter, e.g. \"aaa\"\n    if (!matches.length) {\n      const letters = searchString.current.split('');\n      const allSameLetter = letters.length && letters.every(letter => letter === letters[0]);\n      // if the search is all the same letter, cycle through options starting with that letter\n      if (allSameLetter) {\n        startIndex++;\n        matcher = optionText => optionText.toLowerCase().indexOf(letters[0]) === 0;\n        matches = getOptionsMatchingText(matcher);\n      }\n    }\n    // if there is an active option and multiple matches,\n    // return first matching option after the current active option, looping back to the top\n    if (matches.length > 1 && activeOption) {\n      const nextMatch = matches.find(option => getIndexOfId(option.id) >= startIndex);\n      return nextMatch !== null && nextMatch !== void 0 ? nextMatch : matches[0];\n    }\n    var _matches_;\n    return (_matches_ = matches[0]) !== null && _matches_ !== void 0 ? _matches_ : undefined;\n  };\n  const onTriggerKeyDown = ev => {\n    // clear timeout, if it exists\n    clearKeyTimeout();\n    // if the key was a char key, update search string\n    if (getDropdownActionFromKey(ev) === 'Type') {\n      // update search string\n      searchString.current += ev.key.toLowerCase();\n      setKeyTimeout(() => {\n        searchString.current = '';\n      }, 500);\n      // update state\n      !open && setOpen(ev, true);\n      const nextOption = getNextMatchingOption();\n      setActiveOption(nextOption);\n      setFocusVisible(true);\n    }\n  };\n  // resolve button and listbox slot props\n  let triggerSlot;\n  let listboxSlot;\n  triggerSlot = resolveShorthand(props.button, {\n    required: true,\n    defaultProps: {\n      type: 'button',\n      children: baseState.value || props.placeholder,\n      ...triggerNativeProps\n    }\n  });\n  triggerSlot.onKeyDown = mergeCallbacks(onTriggerKeyDown, triggerSlot.onKeyDown);\n  listboxSlot = baseState.open || baseState.hasFocus ? resolveShorthand(props.listbox, {\n    required: true,\n    defaultProps: {\n      children: props.children,\n      style: {\n        width: popupWidth\n      }\n    }\n  }) : undefined;\n  [triggerSlot, listboxSlot] = useComboboxPopup(props, triggerSlot, listboxSlot);\n  [triggerSlot, listboxSlot] = useTriggerListboxSlots(props, baseState, ref, triggerSlot, listboxSlot);\n  const state = {\n    components: {\n      root: 'div',\n      button: 'button',\n      expandIcon: 'span',\n      listbox: Listbox\n    },\n    root: resolveShorthand(props.root, {\n      required: true,\n      defaultProps: {\n        'aria-owns': !props.inlinePopup ? listboxSlot === null || listboxSlot === void 0 ? void 0 : listboxSlot.id : undefined,\n        children: props.children,\n        ...rootNativeProps\n      }\n    }),\n    button: triggerSlot,\n    listbox: listboxSlot,\n    expandIcon: resolveShorthand(props.expandIcon, {\n      required: true,\n      defaultProps: {\n        children: /*#__PURE__*/React.createElement(ChevronDownIcon, null)\n      }\n    }),\n    placeholderVisible: !baseState.value && !!props.placeholder,\n    ...baseState\n  };\n  state.root.ref = useMergedRefs(state.root.ref, rootRef);\n  return state;\n};\n//# sourceMappingURL=useDropdown.js.map"],"names":["useDropdown_unstable","props","ref","baseState","useComboboxBaseState","activeOption","getIndexOfId","getOptionsMatchingText","open","setActiveOption","setFocusVisible","setOpen","primary","triggerNativeProps","root","rootNativeProps","getPartitionedNativeProps","primarySlotTagName","excludedPropNames","rootRef","React","useRef","popupWidth","setPopupWidth","useState","useEffect","_rootRef_current","width","current","clientWidth","undefined","searchString","setKeyTimeout","clearKeyTimeout","useTimeout","getNextMatchingOption","matcher","optionText","toLowerCase","indexOf","matches","startIndex","id","length","letters","split","allSameLetter","every","letter","nextMatch","find","option","_matches_","onTriggerKeyDown","ev","getDropdownActionFromKey","key","nextOption","triggerSlot","listboxSlot","resolveShorthand","button","required","defaultProps","type","children","value","placeholder","onKeyDown","mergeCallbacks","hasFocus","listbox","style","useComboboxPopup","useTriggerListboxSlots","state","components","expandIcon","Listbox","inlinePopup","createElement","ChevronDownIcon","placeholderVisible","useMergedRefs"],"mappings":"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"}