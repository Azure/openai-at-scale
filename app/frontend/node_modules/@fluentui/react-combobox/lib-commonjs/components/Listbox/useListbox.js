"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "useListbox_unstable", {
    enumerable: true,
    get: ()=>useListbox_unstable
});
const _interopRequireWildcard = require("@swc/helpers/lib/_interop_require_wildcard.js").default;
const _react = /*#__PURE__*/ _interopRequireWildcard(require("react"));
const _reactUtilities = require("@fluentui/react-utilities");
const _reactContextSelector = require("@fluentui/react-context-selector");
const _dropdownKeyActions = require("../../utils/dropdownKeyActions");
const _useOptionCollection = require("../../utils/useOptionCollection");
const _useScrollOptionsIntoView = require("../../utils/useScrollOptionsIntoView");
const _useSelection = require("../../utils/useSelection");
const _comboboxContext = require("../../contexts/ComboboxContext");
const useListbox_unstable = (props, ref)=>{
    const { multiselect  } = props;
    const optionCollection = (0, _useOptionCollection.useOptionCollection)();
    const { getCount , getOptionAtIndex , getIndexOfId  } = optionCollection;
    const { clearSelection , selectedOptions , selectOption  } = (0, _useSelection.useSelection)(props);
    const [activeOption, setActiveOption] = _react.useState();
    // track whether keyboard focus outline should be shown
    // tabster/keyborg doesn't work here, since the actual keyboard focus target doesn't move
    const [focusVisible, setFocusVisible] = _react.useState(false);
    const onKeyDown = (event)=>{
        const action = (0, _dropdownKeyActions.getDropdownActionFromKey)(event, {
            open: true
        });
        const maxIndex = getCount() - 1;
        const activeIndex = activeOption ? getIndexOfId(activeOption.id) : -1;
        let newIndex = activeIndex;
        switch(action){
            case 'Select':
            case 'CloseSelect':
                activeOption && selectOption(event, activeOption);
                break;
            default:
                newIndex = (0, _dropdownKeyActions.getIndexFromAction)(action, activeIndex, maxIndex);
        }
        if (newIndex !== activeIndex) {
            // prevent default page scroll/keyboard action if the index changed
            event.preventDefault();
            setActiveOption(getOptionAtIndex(newIndex));
            setFocusVisible(true);
        }
    };
    const onMouseOver = (event)=>{
        setFocusVisible(false);
    };
    // get state from parent combobox, if it exists
    const hasComboboxContext = (0, _reactContextSelector.useHasParentContext)(_comboboxContext.ComboboxContext);
    const comboboxActiveOption = (0, _reactContextSelector.useContextSelector)(_comboboxContext.ComboboxContext, (ctx)=>ctx.activeOption);
    const comboboxFocusVisible = (0, _reactContextSelector.useContextSelector)(_comboboxContext.ComboboxContext, (ctx)=>ctx.focusVisible);
    const comboboxSelectedOptions = (0, _reactContextSelector.useContextSelector)(_comboboxContext.ComboboxContext, (ctx)=>ctx.selectedOptions);
    const comboboxSelectOption = (0, _reactContextSelector.useContextSelector)(_comboboxContext.ComboboxContext, (ctx)=>ctx.selectOption);
    const comboboxSetActiveOption = (0, _reactContextSelector.useContextSelector)(_comboboxContext.ComboboxContext, (ctx)=>ctx.setActiveOption);
    // without a parent combobox context, provide values directly from Listbox
    const optionContextValues = hasComboboxContext ? {
        activeOption: comboboxActiveOption,
        focusVisible: comboboxFocusVisible,
        selectedOptions: comboboxSelectedOptions,
        selectOption: comboboxSelectOption,
        setActiveOption: comboboxSetActiveOption
    } : {
        activeOption,
        focusVisible,
        selectedOptions,
        selectOption,
        setActiveOption
    };
    const state = {
        components: {
            root: 'div'
        },
        root: (0, _reactUtilities.getNativeElementProps)('div', {
            ref,
            role: multiselect ? 'menu' : 'listbox',
            'aria-activedescendant': hasComboboxContext ? undefined : activeOption === null || activeOption === void 0 ? void 0 : activeOption.id,
            'aria-multiselectable': multiselect,
            tabIndex: 0,
            ...props
        }),
        multiselect,
        clearSelection,
        ...optionCollection,
        ...optionContextValues
    };
    const scrollContainerRef = (0, _useScrollOptionsIntoView.useScrollOptionsIntoView)(state);
    state.root.ref = (0, _reactUtilities.useMergedRefs)(state.root.ref, scrollContainerRef);
    state.root.onKeyDown = (0, _reactUtilities.useEventCallback)((0, _reactUtilities.mergeCallbacks)(state.root.onKeyDown, onKeyDown));
    state.root.onMouseOver = (0, _reactUtilities.useEventCallback)((0, _reactUtilities.mergeCallbacks)(state.root.onMouseOver, onMouseOver));
    return state;
}; //# sourceMappingURL=useListbox.js.map

//# sourceMappingURL=useListbox.js.map