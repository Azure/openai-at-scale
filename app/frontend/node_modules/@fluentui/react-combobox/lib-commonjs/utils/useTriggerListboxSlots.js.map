{"version":3,"sources":["../../lib/utils/useTriggerListboxSlots.js"],"sourcesContent":["import * as React from 'react';\nimport { mergeCallbacks, useId, useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { getDropdownActionFromKey, getIndexFromAction } from '../utils/dropdownKeyActions';\n/*\n * useTriggerListboxSlots returns a tuple of trigger/listbox shorthand,\n * with the semantics and event handlers needed for the Combobox and Dropdown components.\n * The element type of the ref should always match the element type used in the trigger shorthand.\n */\nexport function useTriggerListboxSlots(props, state, ref, triggerSlot, listboxSlot) {\n  const {\n    multiselect\n  } = props;\n  const {\n    activeOption,\n    getCount,\n    getIndexOfId,\n    getOptionAtIndex,\n    ignoreNextBlur,\n    open,\n    selectOption,\n    setActiveOption,\n    setFocusVisible,\n    setHasFocus,\n    setOpen\n  } = state;\n  // handle trigger focus/blur\n  const triggerRef = React.useRef(null);\n  // resolve listbox shorthand props\n  const listboxId = useId('fluent-listbox', listboxSlot === null || listboxSlot === void 0 ? void 0 : listboxSlot.id);\n  const listbox = listboxSlot && {\n    id: listboxId,\n    multiselect,\n    tabIndex: undefined,\n    ...listboxSlot\n  };\n  // resolve trigger shorthand props\n  const trigger = {\n    'aria-expanded': open,\n    'aria-activedescendant': open ? activeOption === null || activeOption === void 0 ? void 0 : activeOption.id : undefined,\n    role: 'combobox',\n    ...triggerSlot,\n    // explicitly type the ref as an intersection here to prevent type errors\n    // since the `children` prop has mutually incompatible types between input/button\n    // functionally both ref and triggerRef will always be the same element type\n    ref: useMergedRefs(ref, triggerSlot === null || triggerSlot === void 0 ? void 0 : triggerSlot.ref, triggerRef)\n  };\n  /*\n  * Handle focus when clicking the listbox popup:\n  * 1. Move focus back to the button/input when the listbox is clicked (otherwise it goes to body)\n  * 2. Do not close the listbox on button/input blur when clicking into the listbox\n  */\n  const listboxOnClick = useEventCallback(mergeCallbacks(event => {\n    var _triggerRef_current;\n    (_triggerRef_current = triggerRef.current) === null || _triggerRef_current === void 0 ? void 0 : _triggerRef_current.focus();\n  }, listbox === null || listbox === void 0 ? void 0 : listbox.onClick));\n  const listboxOnMouseOver = useEventCallback(mergeCallbacks(event => {\n    setFocusVisible(false);\n  }, listbox === null || listbox === void 0 ? void 0 : listbox.onMouseOver));\n  const listboxOnMouseDown = useEventCallback(mergeCallbacks(event => {\n    ignoreNextBlur.current = true;\n  }, listbox === null || listbox === void 0 ? void 0 : listbox.onMouseDown));\n  // listbox is nullable, only add event handlers if it exists\n  if (listbox) {\n    listbox.onClick = listboxOnClick;\n    listbox.onMouseOver = listboxOnMouseOver;\n    listbox.onMouseDown = listboxOnMouseDown;\n  }\n  // the trigger should open/close the popup on click or blur\n  trigger.onBlur = mergeCallbacks(event => {\n    if (!ignoreNextBlur.current) {\n      setOpen(event, false);\n    }\n    ignoreNextBlur.current = false;\n    setHasFocus(false);\n  }, trigger.onBlur);\n  trigger.onClick = mergeCallbacks(event => {\n    setOpen(event, !open);\n  }, trigger.onClick);\n  trigger.onFocus = mergeCallbacks(event => {\n    setHasFocus(true);\n  }, trigger.onFocus);\n  // handle combobox keyboard interaction\n  trigger.onKeyDown = mergeCallbacks(event => {\n    const action = getDropdownActionFromKey(event, {\n      open,\n      multiselect\n    });\n    const maxIndex = getCount() - 1;\n    const activeIndex = activeOption ? getIndexOfId(activeOption.id) : -1;\n    let newIndex = activeIndex;\n    switch (action) {\n      case 'Open':\n        event.preventDefault();\n        setFocusVisible(true);\n        setOpen(event, true);\n        break;\n      case 'Close':\n        // stop propagation for escape key to avoid dismissing any parent popups\n        event.stopPropagation();\n        event.preventDefault();\n        setOpen(event, false);\n        break;\n      case 'CloseSelect':\n        !multiselect && !(activeOption === null || activeOption === void 0 ? void 0 : activeOption.disabled) && setOpen(event, false);\n      // fallthrough\n      case 'Select':\n        activeOption && selectOption(event, activeOption);\n        event.preventDefault();\n        break;\n      case 'Tab':\n        !multiselect && activeOption && selectOption(event, activeOption);\n        break;\n      default:\n        newIndex = getIndexFromAction(action, activeIndex, maxIndex);\n    }\n    if (newIndex !== activeIndex) {\n      // prevent default page scroll/keyboard action if the index changed\n      event.preventDefault();\n      setActiveOption(getOptionAtIndex(newIndex));\n      setFocusVisible(true);\n    }\n  }, trigger.onKeyDown);\n  trigger.onMouseOver = mergeCallbacks(event => {\n    setFocusVisible(false);\n  }, trigger.onMouseOver);\n  return [trigger, listbox];\n}\n//# sourceMappingURL=useTriggerListboxSlots.js.map"],"names":["useTriggerListboxSlots","props","state","ref","triggerSlot","listboxSlot","multiselect","activeOption","getCount","getIndexOfId","getOptionAtIndex","ignoreNextBlur","open","selectOption","setActiveOption","setFocusVisible","setHasFocus","setOpen","triggerRef","React","useRef","listboxId","useId","id","listbox","tabIndex","undefined","trigger","role","useMergedRefs","listboxOnClick","useEventCallback","mergeCallbacks","event","_triggerRef_current","current","focus","onClick","listboxOnMouseOver","onMouseOver","listboxOnMouseDown","onMouseDown","onBlur","onFocus","onKeyDown","action","getDropdownActionFromKey","maxIndex","activeIndex","newIndex","preventDefault","stopPropagation","disabled","getIndexFromAction"],"mappings":"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"}