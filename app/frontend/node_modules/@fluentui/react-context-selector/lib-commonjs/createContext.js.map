{"version":3,"sources":["../lib/createContext.js"],"sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { unstable_NormalPriority as NormalPriority, unstable_runWithPriority as runWithPriority } from 'scheduler';\nconst createProvider = Original => {\n  const Provider = props => {\n    // Holds an actual \"props.value\"\n    const valueRef = React.useRef(props.value);\n    // Used to sync context updates and avoid stale values, can be considered as render/effect counter of Provider.\n    const versionRef = React.useRef(0);\n    // A stable object, is used to avoid context updates via mutation of its values.\n    const contextValue = React.useRef();\n    if (!contextValue.current) {\n      contextValue.current = {\n        value: valueRef,\n        version: versionRef,\n        listeners: []\n      };\n    }\n    useIsomorphicLayoutEffect(() => {\n      valueRef.current = props.value;\n      versionRef.current += 1;\n      runWithPriority(NormalPriority, () => {\n        contextValue.current.listeners.forEach(listener => {\n          listener([versionRef.current, props.value]);\n        });\n      });\n    }, [props.value]);\n    return /*#__PURE__*/React.createElement(Original, {\n      value: contextValue.current\n    }, props.children);\n  };\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== 'production') {\n    Provider.displayName = 'ContextSelector.Provider';\n  }\n  return Provider;\n};\n/**\n * @internal\n */\nexport const createContext = defaultValue => {\n  // eslint-disable-next-line @fluentui/no-context-default-value\n  const context = /*#__PURE__*/React.createContext({\n    value: {\n      current: defaultValue\n    },\n    version: {\n      current: -1\n    },\n    listeners: []\n  });\n  context.Provider = createProvider(context.Provider);\n  // We don't support Consumer API\n  delete context.Consumer;\n  return context;\n};\n//# sourceMappingURL=createContext.js.map"],"names":["createContext","createProvider","Original","Provider","props","valueRef","React","useRef","value","versionRef","contextValue","current","version","listeners","useIsomorphicLayoutEffect","runWithPriority","NormalPriority","forEach","listener","createElement","children","process","env","NODE_ENV","displayName","defaultValue","context","Consumer"],"mappings":";;;;+BAwCaA;;aAAAA;;;gCAxC6B;6DACnB;2BACgF;AACvG,MAAMC,iBAAiBC,CAAAA,WAAY;IACjC,MAAMC,WAAWC,CAAAA,QAAS;QACxB,gCAAgC;QAChC,MAAMC,WAAWC,OAAMC,MAAM,CAACH,MAAMI,KAAK;QACzC,+GAA+G;QAC/G,MAAMC,aAAaH,OAAMC,MAAM,CAAC;QAChC,gFAAgF;QAChF,MAAMG,eAAeJ,OAAMC,MAAM;QACjC,IAAI,CAACG,aAAaC,OAAO,EAAE;YACzBD,aAAaC,OAAO,GAAG;gBACrBH,OAAOH;gBACPO,SAASH;gBACTI,WAAW,EAAE;YACf;QACF,CAAC;QACDC,IAAAA,yCAAyB,EAAC,IAAM;YAC9BT,SAASM,OAAO,GAAGP,MAAMI,KAAK;YAC9BC,WAAWE,OAAO,IAAI;YACtBI,IAAAA,mCAAe,EAACC,kCAAc,EAAE,IAAM;gBACpCN,aAAaC,OAAO,CAACE,SAAS,CAACI,OAAO,CAACC,CAAAA,WAAY;oBACjDA,SAAS;wBAACT,WAAWE,OAAO;wBAAEP,MAAMI,KAAK;qBAAC;gBAC5C;YACF;QACF,GAAG;YAACJ,MAAMI,KAAK;SAAC;QAChB,OAAO,WAAW,GAAEF,OAAMa,aAAa,CAACjB,UAAU;YAChDM,OAAOE,aAAaC,OAAO;QAC7B,GAAGP,MAAMgB,QAAQ;IACnB;IACA,wBAAwB,GACxB,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QACzCpB,SAASqB,WAAW,GAAG;IACzB,CAAC;IACD,OAAOrB;AACT;AAIO,MAAMH,gBAAgByB,CAAAA,eAAgB;IAC3C,8DAA8D;IAC9D,MAAMC,UAAU,WAAW,GAAEpB,OAAMN,aAAa,CAAC;QAC/CQ,OAAO;YACLG,SAASc;QACX;QACAb,SAAS;YACPD,SAAS,CAAC;QACZ;QACAE,WAAW,EAAE;IACf;IACAa,QAAQvB,QAAQ,GAAGF,eAAeyB,QAAQvB,QAAQ;IAClD,gCAAgC;IAChC,OAAOuB,QAAQC,QAAQ;IACvB,OAAOD;AACT,GACA,yCAAyC"}