{"version":3,"sources":["../lib/useContextSelector.js"],"sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\n/**\n * @internal\n * This hook returns context selected value by selector.\n * It will only accept context created by `createContext`.\n * It will trigger re-render if only the selected value is referentially changed.\n */\nexport const useContextSelector = (context, selector) => {\n  const contextValue = React.useContext(context);\n  const {\n    value: {\n      current: value\n    },\n    version: {\n      current: version\n    },\n    listeners\n  } = contextValue;\n  const selected = selector(value);\n  const [state, dispatch] = React.useReducer((prevState, payload) => {\n    if (!payload) {\n      // early bail out when is dispatched during render\n      return [value, selected];\n    }\n    if (payload[0] <= version) {\n      if (objectIs(prevState[1], selected)) {\n        return prevState; // bail out\n      }\n\n      return [value, selected];\n    }\n    try {\n      if (objectIs(prevState[0], payload[1])) {\n        return prevState; // do not update\n      }\n\n      const nextSelected = selector(payload[1]);\n      if (objectIs(prevState[1], nextSelected)) {\n        return prevState; // do not update\n      }\n\n      return [payload[1], nextSelected];\n    } catch (e) {\n      // ignored (stale props or some other reason)\n    }\n    // explicitly spread to enforce typing\n    return [prevState[0], prevState[1]]; // schedule update\n  }, [value, selected]);\n  if (!objectIs(state[1], selected)) {\n    // schedule re-render\n    // this is safe because it's self contained\n    dispatch(undefined);\n  }\n  useIsomorphicLayoutEffect(() => {\n    listeners.push(dispatch);\n    return () => {\n      const index = listeners.indexOf(dispatch);\n      listeners.splice(index, 1);\n    };\n  }, [listeners]);\n  return state[1];\n};\n/**\n * inlined Object.is polyfill to avoid requiring consumers ship their own\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\n */ // eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction is(x, y) {\n  return x === y && (x !== 0 || 1 / x === 1 / y) || x !== x && y !== y // eslint-disable-line no-self-compare\n  ;\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst objectIs =\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore fallback to native if it exists (not in IE11)\ntypeof Object.is === 'function' ? Object.is : is;\n//# sourceMappingURL=useContextSelector.js.map"],"names":["useContextSelector","context","selector","contextValue","React","useContext","value","current","version","listeners","selected","state","dispatch","useReducer","prevState","payload","objectIs","nextSelected","e","undefined","useIsomorphicLayoutEffect","push","index","indexOf","splice","is","x","y","Object"],"mappings":";;;;+BAQaA;;aAAAA;;;gCAR6B;6DACnB;AAOhB,MAAMA,qBAAqB,CAACC,SAASC,WAAa;IACvD,MAAMC,eAAeC,OAAMC,UAAU,CAACJ;IACtC,MAAM,EACJK,OAAO,EACLC,SAASD,MAAK,EACf,CAAA,EACDE,SAAS,EACPD,SAASC,QAAO,EACjB,CAAA,EACDC,UAAS,EACV,GAAGN;IACJ,MAAMO,WAAWR,SAASI;IAC1B,MAAM,CAACK,OAAOC,SAAS,GAAGR,OAAMS,UAAU,CAAC,CAACC,WAAWC,UAAY;QACjE,IAAI,CAACA,SAAS;YACZ,kDAAkD;YAClD,OAAO;gBAACT;gBAAOI;aAAS;QAC1B,CAAC;QACD,IAAIK,OAAO,CAAC,EAAE,IAAIP,SAAS;YACzB,IAAIQ,SAASF,SAAS,CAAC,EAAE,EAAEJ,WAAW;gBACpC,OAAOI,WAAW,WAAW;YAC/B,CAAC;YAED,OAAO;gBAACR;gBAAOI;aAAS;QAC1B,CAAC;QACD,IAAI;YACF,IAAIM,SAASF,SAAS,CAAC,EAAE,EAAEC,OAAO,CAAC,EAAE,GAAG;gBACtC,OAAOD,WAAW,gBAAgB;YACpC,CAAC;YAED,MAAMG,eAAef,SAASa,OAAO,CAAC,EAAE;YACxC,IAAIC,SAASF,SAAS,CAAC,EAAE,EAAEG,eAAe;gBACxC,OAAOH,WAAW,gBAAgB;YACpC,CAAC;YAED,OAAO;gBAACC,OAAO,CAAC,EAAE;gBAAEE;aAAa;QACnC,EAAE,OAAOC,GAAG;QACV,6CAA6C;QAC/C;QACA,sCAAsC;QACtC,OAAO;YAACJ,SAAS,CAAC,EAAE;YAAEA,SAAS,CAAC,EAAE;SAAC,EAAE,kBAAkB;IACzD,GAAG;QAACR;QAAOI;KAAS;IACpB,IAAI,CAACM,SAASL,KAAK,CAAC,EAAE,EAAED,WAAW;QACjC,qBAAqB;QACrB,2CAA2C;QAC3CE,SAASO;IACX,CAAC;IACDC,IAAAA,yCAAyB,EAAC,IAAM;QAC9BX,UAAUY,IAAI,CAACT;QACf,OAAO,IAAM;YACX,MAAMU,QAAQb,UAAUc,OAAO,CAACX;YAChCH,UAAUe,MAAM,CAACF,OAAO;QAC1B;IACF,GAAG;QAACb;KAAU;IACd,OAAOE,KAAK,CAAC,EAAE;AACjB;AACA;;;CAGC,GAAG,8DAA8D;AAClE,SAASc,GAAGC,CAAC,EAAEC,CAAC,EAAE;IAChB,OAAOD,MAAMC,KAAMD,CAAAA,MAAM,KAAK,IAAIA,MAAM,IAAIC,CAAAA,KAAMD,MAAMA,KAAKC,MAAMA,EAAE,sCAAsC;;AAE7G;AACA,8DAA8D;AAC9D,MAAMX,WACN,6DAA6D;AAC7D,2DAA2D;AAC3D,OAAOY,OAAOH,EAAE,KAAK,aAAaG,OAAOH,EAAE,GAAGA,EAAE,EAChD,8CAA8C"}