{"version":3,"sources":["../../../lib/components/MenuPopover/useMenuPopover.js"],"sourcesContent":["import * as React from 'react';\nimport { ArrowLeft, Tab, ArrowRight, Escape } from '@fluentui/keyboard-keys';\nimport { getNativeElementProps, useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { useMenuContext_unstable } from '../../contexts/menuContext';\nimport { dispatchMenuEnterEvent } from '../../utils/index';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { useIsSubmenu } from '../../utils/useIsSubmenu';\n/**\n * Create the state required to render MenuPopover.\n *\n * The returned state can be modified with hooks such as useMenuPopoverStyles_unstable,\n * before being passed to renderMenuPopover_unstable.\n *\n * @param props - props from this instance of MenuPopover\n * @param ref - reference to root HTMLElement of MenuPopover\n */\nexport const useMenuPopover_unstable = (props, ref) => {\n  const popoverRef = useMenuContext_unstable(context => context.menuPopoverRef);\n  const setOpen = useMenuContext_unstable(context => context.setOpen);\n  const open = useMenuContext_unstable(context => context.open);\n  const openOnHover = useMenuContext_unstable(context => context.openOnHover);\n  const isSubmenu = useIsSubmenu();\n  const canDispatchCustomEventRef = React.useRef(true);\n  const throttleDispatchTimerRef = React.useRef(0);\n  const {\n    dir\n  } = useFluent();\n  const CloseArrowKey = dir === 'ltr' ? ArrowLeft : ArrowRight;\n  // use DOM listener since react events propagate up the react tree\n  // no need to do `contains` logic as menus are all positioned in different portals\n  const mouseOverListenerCallbackRef = React.useCallback(node => {\n    if (node) {\n      // Dispatches the custom menu mouse enter event with throttling\n      // Needs to trigger on mouseover to support keyboard + mouse together\n      // i.e. keyboard opens submenus while cursor is still on the parent\n      node.addEventListener('mouseover', e => {\n        if (canDispatchCustomEventRef.current) {\n          canDispatchCustomEventRef.current = false;\n          dispatchMenuEnterEvent(popoverRef.current, e);\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore #16889 Node setTimeout type leaking\n          throttleDispatchTimerRef.current = setTimeout(() => canDispatchCustomEventRef.current = true, 250);\n        }\n      });\n    }\n  }, [popoverRef, throttleDispatchTimerRef]);\n  React.useEffect(() => {\n    () => clearTimeout(throttleDispatchTimerRef.current);\n  }, []);\n  var _useMenuContext_unstable;\n  const inline = (_useMenuContext_unstable = useMenuContext_unstable(context => context.inline)) !== null && _useMenuContext_unstable !== void 0 ? _useMenuContext_unstable : false;\n  const mountNode = useMenuContext_unstable(context => context.mountNode);\n  const rootProps = getNativeElementProps('div', {\n    role: 'presentation',\n    ...props,\n    ref: useMergedRefs(ref, popoverRef, mouseOverListenerCallbackRef)\n  });\n  const {\n    onMouseEnter: onMouseEnterOriginal,\n    onKeyDown: onKeyDownOriginal\n  } = rootProps;\n  rootProps.onMouseEnter = useEventCallback(event => {\n    if (openOnHover) {\n      setOpen(event, {\n        open: true,\n        keyboard: false,\n        type: 'menuPopoverMouseEnter',\n        event\n      });\n    }\n    onMouseEnterOriginal === null || onMouseEnterOriginal === void 0 ? void 0 : onMouseEnterOriginal(event);\n  });\n  rootProps.onKeyDown = useEventCallback(event => {\n    const key = event.key;\n    if (key === Escape || isSubmenu && key === CloseArrowKey) {\n      var _popoverRef_current;\n      if (open && ((_popoverRef_current = popoverRef.current) === null || _popoverRef_current === void 0 ? void 0 : _popoverRef_current.contains(event.target))) {\n        setOpen(event, {\n          open: false,\n          keyboard: true,\n          type: 'menuPopoverKeyDown',\n          event\n        });\n        // stop propagation to avoid conflicting with other elements that listen for `Escape`\n        // e,g: Dialog, Popover and Tooltip\n        event.stopPropagation();\n      }\n    }\n    if (key === Tab) {\n      setOpen(event, {\n        open: false,\n        keyboard: true,\n        type: 'menuPopoverKeyDown',\n        event\n      });\n    }\n    onKeyDownOriginal === null || onKeyDownOriginal === void 0 ? void 0 : onKeyDownOriginal(event);\n  });\n  return {\n    inline,\n    mountNode,\n    components: {\n      root: 'div'\n    },\n    root: rootProps\n  };\n};\n//# sourceMappingURL=useMenuPopover.js.map"],"names":["useMenuPopover_unstable","props","ref","popoverRef","useMenuContext_unstable","context","menuPopoverRef","setOpen","open","openOnHover","isSubmenu","useIsSubmenu","canDispatchCustomEventRef","React","useRef","throttleDispatchTimerRef","dir","useFluent","CloseArrowKey","ArrowLeft","ArrowRight","mouseOverListenerCallbackRef","useCallback","node","addEventListener","e","current","dispatchMenuEnterEvent","setTimeout","useEffect","clearTimeout","_useMenuContext_unstable","inline","mountNode","rootProps","getNativeElementProps","role","useMergedRefs","onMouseEnter","onMouseEnterOriginal","onKeyDown","onKeyDownOriginal","useEventCallback","event","keyboard","type","key","Escape","_popoverRef_current","contains","target","stopPropagation","Tab","components","root"],"mappings":"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"}