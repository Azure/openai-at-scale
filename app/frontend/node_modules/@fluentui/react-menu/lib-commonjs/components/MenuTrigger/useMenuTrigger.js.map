{"version":3,"sources":["../../../lib/components/MenuTrigger/useMenuTrigger.js"],"sourcesContent":["import * as React from 'react';\nimport { useMenuContext_unstable } from '../../contexts/menuContext';\nimport { useIsSubmenu } from '../../utils/useIsSubmenu';\nimport { useFocusFinders } from '@fluentui/react-tabster';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { ArrowRight, ArrowLeft, Escape, ArrowDown } from '@fluentui/keyboard-keys';\nimport { applyTriggerPropsToChildren, getTriggerChild, isHTMLElement, mergeCallbacks, useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { useARIAButtonProps } from '@fluentui/react-aria';\n/**\n * Create the state required to render MenuTrigger.\n * Clones the only child component and adds necessary event handling behaviours to open a popup menu\n *\n * @param props - props from this instance of MenuTrigger\n */\nexport const useMenuTrigger_unstable = props => {\n  const {\n    children,\n    disableButtonEnhancement = false\n  } = props;\n  const triggerRef = useMenuContext_unstable(context => context.triggerRef);\n  const menuPopoverRef = useMenuContext_unstable(context => context.menuPopoverRef);\n  const setOpen = useMenuContext_unstable(context => context.setOpen);\n  const open = useMenuContext_unstable(context => context.open);\n  const triggerId = useMenuContext_unstable(context => context.triggerId);\n  const openOnHover = useMenuContext_unstable(context => context.openOnHover);\n  const openOnContext = useMenuContext_unstable(context => context.openOnContext);\n  const isSubmenu = useIsSubmenu();\n  const {\n    findFirstFocusable\n  } = useFocusFinders();\n  const focusFirst = React.useCallback(() => {\n    const firstFocusable = findFirstFocusable(menuPopoverRef.current);\n    firstFocusable === null || firstFocusable === void 0 ? void 0 : firstFocusable.focus();\n  }, [findFirstFocusable, menuPopoverRef]);\n  const openedWithKeyboardRef = React.useRef(false);\n  const hasMouseMoved = React.useRef(false);\n  const {\n    dir\n  } = useFluent();\n  const OpenArrowKey = dir === 'ltr' ? ArrowRight : ArrowLeft;\n  const child = getTriggerChild(children);\n  const onContextMenu = event => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnContext) {\n      event.preventDefault();\n      setOpen(event, {\n        open: true,\n        keyboard: false,\n        type: 'menuTriggerContextMenu',\n        event\n      });\n    }\n  };\n  const onClick = event => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (!openOnContext) {\n      setOpen(event, {\n        open: !open,\n        keyboard: openedWithKeyboardRef.current,\n        type: 'menuTriggerClick',\n        event\n      });\n      openedWithKeyboardRef.current = false;\n    }\n  };\n  const onKeyDown = event => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    const key = event.key;\n    if (!openOnContext && (isSubmenu && key === OpenArrowKey || !isSubmenu && key === ArrowDown)) {\n      setOpen(event, {\n        open: true,\n        keyboard: true,\n        type: 'menuTriggerKeyDown',\n        event\n      });\n    }\n    if (key === Escape && !isSubmenu) {\n      setOpen(event, {\n        open: false,\n        keyboard: true,\n        type: 'menuTriggerKeyDown',\n        event\n      });\n    }\n    // if menu is already open, can't rely on effects to focus\n    if (open && key === OpenArrowKey && isSubmenu) {\n      focusFirst();\n    }\n  };\n  const onMouseEnter = event => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnHover && hasMouseMoved.current) {\n      setOpen(event, {\n        open: true,\n        keyboard: false,\n        type: 'menuTriggerMouseEnter',\n        event\n      });\n    }\n  };\n  // Opening a menu when a mouse hasn't moved and just entering the trigger is a bad a11y experience\n  // First time open the mouse using mousemove and then continue with mouseenter\n  // Only use once to determine that the user is using the mouse since it is an expensive event to handle\n  const onMouseMove = event => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnHover && !hasMouseMoved.current) {\n      setOpen(event, {\n        open: true,\n        keyboard: false,\n        type: 'menuTriggerMouseMove',\n        event\n      });\n      hasMouseMoved.current = true;\n    }\n  };\n  const onMouseLeave = event => {\n    if (isTargetDisabled(event)) {\n      return;\n    }\n    if (openOnHover) {\n      setOpen(event, {\n        open: false,\n        keyboard: false,\n        type: 'menuTriggerMouseLeave',\n        event\n      });\n    }\n  };\n  const contextMenuProps = {\n    id: triggerId,\n    ...(child === null || child === void 0 ? void 0 : child.props),\n    ref: useMergedRefs(triggerRef, child === null || child === void 0 ? void 0 : child.ref),\n    onMouseEnter: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onMouseEnter, onMouseEnter)),\n    onMouseLeave: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onMouseLeave, onMouseLeave)),\n    onContextMenu: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onContextMenu, onContextMenu)),\n    onMouseMove: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onMouseMove, onMouseMove))\n  };\n  const triggerChildProps = {\n    'aria-haspopup': 'menu',\n    'aria-expanded': !open && !isSubmenu ? undefined : open,\n    ...contextMenuProps,\n    onClick: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onClick, onClick)),\n    onKeyDown: useEventCallback(mergeCallbacks(child === null || child === void 0 ? void 0 : child.props.onKeyDown, onKeyDown))\n  };\n  const ariaButtonTriggerChildProps = useARIAButtonProps((child === null || child === void 0 ? void 0 : child.type) === 'button' || (child === null || child === void 0 ? void 0 : child.type) === 'a' ? child.type : 'div', triggerChildProps);\n  return {\n    isSubmenu,\n    children: applyTriggerPropsToChildren(children, openOnContext ? contextMenuProps : disableButtonEnhancement ? triggerChildProps : ariaButtonTriggerChildProps)\n  };\n};\nconst isTargetDisabled = event => {\n  const isDisabled = el => el.hasAttribute('disabled') || el.hasAttribute('aria-disabled') && el.getAttribute('aria-disabled') === 'true';\n  if (isHTMLElement(event.target) && isDisabled(event.target)) {\n    return true;\n  }\n  return isHTMLElement(event.currentTarget) && isDisabled(event.currentTarget);\n};\n//# sourceMappingURL=useMenuTrigger.js.map"],"names":["useMenuTrigger_unstable","props","children","disableButtonEnhancement","triggerRef","useMenuContext_unstable","context","menuPopoverRef","setOpen","open","triggerId","openOnHover","openOnContext","isSubmenu","useIsSubmenu","findFirstFocusable","useFocusFinders","focusFirst","React","useCallback","firstFocusable","current","focus","openedWithKeyboardRef","useRef","hasMouseMoved","dir","useFluent","OpenArrowKey","ArrowRight","ArrowLeft","child","getTriggerChild","onContextMenu","event","isTargetDisabled","preventDefault","keyboard","type","onClick","onKeyDown","key","ArrowDown","Escape","onMouseEnter","onMouseMove","onMouseLeave","contextMenuProps","id","ref","useMergedRefs","useEventCallback","mergeCallbacks","triggerChildProps","undefined","ariaButtonTriggerChildProps","useARIAButtonProps","applyTriggerPropsToChildren","isDisabled","el","hasAttribute","getAttribute","isHTMLElement","target","currentTarget"],"mappings":"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"}