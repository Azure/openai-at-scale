{"version":3,"sources":["../../lib/hooks/useKeyboardResizing.js"],"sourcesContent":["import * as React from 'react';\nimport { ArrowLeft, ArrowRight, Enter, Escape, Shift, Space } from '@fluentui/keyboard-keys';\nimport { useEventCallback } from '@fluentui/react-utilities';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nconst STEP = 20;\nconst PRECISION_MODIFIER = Shift;\nconst PRECISION_FACTOR = 1 / 4;\nexport function useKeyboardResizing(columnResizeState) {\n  const columnId = React.useRef();\n  const onChangeRef = React.useRef();\n  const addListenerTimeout = React.useRef();\n  const columnResizeStateRef = React.useRef(columnResizeState);\n  React.useEffect(() => {\n    columnResizeStateRef.current = columnResizeState;\n  }, [columnResizeState]);\n  const {\n    targetDocument\n  } = useFluent();\n  const keyboardHandler = useEventCallback(event => {\n    const colId = columnId.current;\n    if (!colId) {\n      return;\n    }\n    const width = columnResizeStateRef.current.getColumnWidth(colId);\n    const precisionModifier = event.getModifierState(PRECISION_MODIFIER);\n    const stopEvent = () => {\n      event.preventDefault();\n      event.stopPropagation();\n    };\n    switch (event.key) {\n      case ArrowLeft:\n        stopEvent();\n        columnResizeStateRef.current.setColumnWidth(event, {\n          columnId: colId,\n          width: width - (precisionModifier ? STEP * PRECISION_FACTOR : STEP)\n        });\n        return;\n      case ArrowRight:\n        stopEvent();\n        columnResizeStateRef.current.setColumnWidth(event, {\n          columnId: colId,\n          width: width + (precisionModifier ? STEP * PRECISION_FACTOR : STEP)\n        });\n        return;\n      case Space:\n      case Enter:\n      case Escape:\n        stopEvent();\n        disableInteractiveMode();\n        break;\n    }\n  });\n  // On component unmout, cancel any timer for adding a listener (if it exists) and remove the listener\n  React.useEffect(() => {\n    return () => {\n      var _targetDocument_defaultView, _targetDocument_defaultView1;\n      targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.clearTimeout(addListenerTimeout.current);\n      targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView1 = targetDocument.defaultView) === null || _targetDocument_defaultView1 === void 0 ? void 0 : _targetDocument_defaultView1.removeEventListener('keydown', keyboardHandler);\n    };\n  }, [keyboardHandler, targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.defaultView]);\n  const enableInteractiveMode = React.useCallback(colId => {\n    var _onChangeRef_current, _targetDocument_defaultView;\n    columnId.current = colId;\n    (_onChangeRef_current = onChangeRef.current) === null || _onChangeRef_current === void 0 ? void 0 : _onChangeRef_current.call(onChangeRef, colId, true);\n    // Create the listener in the next tick, because the event that triggered this is still propagating\n    // when Enter was pressed and would be caught in the keyboardHandler, disabling the keyboard mode immediately.\n    // No idea why this is happening, but this is a working workaround.\n    // Tracked here: https://github.com/microsoft/fluentui/issues/27177\n    addListenerTimeout.current = targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.setTimeout(() => {\n      var _targetDocument_defaultView;\n      targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.addEventListener('keydown', keyboardHandler);\n    }, 0);\n  }, [keyboardHandler, targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.defaultView]);\n  const disableInteractiveMode = React.useCallback(() => {\n    var _targetDocument_defaultView;\n    if (columnId.current) {\n      var _onChangeRef_current;\n      (_onChangeRef_current = onChangeRef.current) === null || _onChangeRef_current === void 0 ? void 0 : _onChangeRef_current.call(onChangeRef, columnId.current, false);\n    }\n    columnId.current = undefined;\n    targetDocument === null || targetDocument === void 0 ? void 0 : (_targetDocument_defaultView = targetDocument.defaultView) === null || _targetDocument_defaultView === void 0 ? void 0 : _targetDocument_defaultView.removeEventListener('keydown', keyboardHandler);\n  }, [keyboardHandler, targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.defaultView]);\n  const toggleInteractiveMode = (colId, onChange) => {\n    onChangeRef.current = onChange;\n    if (!columnId.current) {\n      enableInteractiveMode(colId);\n    } else if (colId && columnId.current !== colId) {\n      columnId.current = colId;\n      onChange === null || onChange === void 0 ? void 0 : onChange(columnId.current, true);\n    } else {\n      disableInteractiveMode();\n    }\n  };\n  return {\n    toggleInteractiveMode\n  };\n}\n//# sourceMappingURL=useKeyboardResizing.js.map"],"names":["useKeyboardResizing","STEP","PRECISION_MODIFIER","Shift","PRECISION_FACTOR","columnResizeState","columnId","React","useRef","onChangeRef","addListenerTimeout","columnResizeStateRef","useEffect","current","targetDocument","useFluent","keyboardHandler","useEventCallback","event","colId","width","getColumnWidth","precisionModifier","getModifierState","stopEvent","preventDefault","stopPropagation","key","ArrowLeft","setColumnWidth","ArrowRight","Space","Enter","Escape","disableInteractiveMode","_targetDocument_defaultView","_targetDocument_defaultView1","defaultView","clearTimeout","removeEventListener","enableInteractiveMode","useCallback","_onChangeRef_current","call","setTimeout","addEventListener","undefined","toggleInteractiveMode","onChange"],"mappings":"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"}