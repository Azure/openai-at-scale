{"version":3,"sources":["../../../lib/components/TreeItem/useTreeItem.js"],"sourcesContent":["import * as React from 'react';\nimport { getNativeElementProps, isResolvedShorthand, resolveShorthand, useId } from '@fluentui/react-utilities';\nimport { ChevronRight12Regular } from '@fluentui/react-icons';\nimport { useFluent_unstable } from '@fluentui/react-shared-contexts';\nimport { useEventCallback } from '@fluentui/react-utilities';\nimport { expandIconInlineStyles } from './useTreeItemStyles';\nimport { ArrowDown, ArrowLeft, ArrowRight, ArrowUp, End, Enter, Home } from '@fluentui/keyboard-keys';\nimport { useMergedRefs } from '@fluentui/react-utilities';\nimport { elementContains } from '@fluentui/react-portal';\nimport { useTreeContext_unstable } from '../../contexts/index';\nimport { treeDataTypes } from '../../utils/tokens';\n/**\n * Create the state required to render TreeItem.\n *\n * The returned state can be modified with hooks such as useTreeItemStyles_unstable,\n * before being passed to renderTreeItem_unstable.\n *\n * @param props - props from this instance of TreeItem\n * @param ref - reference to root HTMLElement of TreeItem\n */\nexport const useTreeItem_unstable = (props, ref) => {\n  const [children, subtreeChildren] = React.Children.toArray(props.children);\n  const contextLevel = useTreeContext_unstable(ctx => ctx.level);\n  const {\n    content,\n    subtree,\n    expandIcon,\n    leaf: isLeaf = subtreeChildren === undefined,\n    actions,\n    as = 'div',\n    onClick,\n    onKeyDown,\n    ['aria-level']: level = contextLevel,\n    ...rest\n  } = props;\n  const requestOpenChange = useTreeContext_unstable(ctx => ctx.requestOpenChange);\n  const requestNavigation = useTreeContext_unstable(ctx => ctx.requestNavigation);\n  const id = useId('fui-TreeItem-', props.id);\n  const isBranch = !isLeaf;\n  const open = useTreeContext_unstable(ctx => isBranch && ctx.openItems.has(id));\n  const {\n    dir,\n    targetDocument\n  } = useFluent_unstable();\n  const expandIconRotation = open ? 90 : dir !== 'rtl' ? 0 : 180;\n  const actionsRef = React.useRef(null);\n  const expandIconRef = React.useRef(null);\n  const subtreeRef = React.useRef(null);\n  const handleArrowRight = event => {\n    if (!open && isBranch) {\n      return requestOpenChange({\n        event,\n        open: true,\n        type: treeDataTypes.arrowRight,\n        target: event.currentTarget\n      });\n    }\n    if (open && isBranch) {\n      return requestNavigation({\n        event,\n        type: treeDataTypes.arrowRight,\n        target: event.currentTarget\n      });\n    }\n  };\n  const handleArrowLeft = event => {\n    if (open && isBranch) {\n      return requestOpenChange({\n        event,\n        open: false,\n        type: treeDataTypes.arrowLeft,\n        target: event.currentTarget\n      });\n    }\n    if (!open && level > 1) {\n      return requestNavigation({\n        event,\n        target: event.currentTarget,\n        type: treeDataTypes.arrowLeft\n      });\n    }\n  };\n  const handleEnter = event => {\n    requestOpenChange({\n      event,\n      open: isLeaf ? open : !open,\n      type: treeDataTypes.enter,\n      target: event.currentTarget\n    });\n  };\n  const handleClick = useEventCallback(event => {\n    onClick === null || onClick === void 0 ? void 0 : onClick(event);\n    const isEventFromActions = actionsRef.current && elementContains(actionsRef.current, event.target);\n    if (isEventFromActions) {\n      return;\n    }\n    const isEventFromSubtree = subtreeRef.current && elementContains(subtreeRef.current, event.target);\n    if (isEventFromSubtree) {\n      return;\n    }\n    const isFromExpandIcon = expandIconRef.current && elementContains(expandIconRef.current, event.target);\n    requestOpenChange({\n      event,\n      open: isLeaf ? open : !open,\n      type: isFromExpandIcon ? treeDataTypes.expandIconClick : treeDataTypes.click,\n      target: event.currentTarget\n    });\n    requestNavigation({\n      event,\n      target: event.currentTarget,\n      type: treeDataTypes.click\n    });\n  });\n  const handleKeyDown = useEventCallback(event => {\n    onKeyDown === null || onKeyDown === void 0 ? void 0 : onKeyDown(event);\n    if (event.currentTarget !== event.target) {\n      return;\n    }\n    if (event.isDefaultPrevented()) {\n      return;\n    }\n    switch (event.key) {\n      case Enter:\n        return handleEnter(event);\n      case ArrowRight:\n        return handleArrowRight(event);\n      case ArrowLeft:\n        return handleArrowLeft(event);\n      case End:\n        return requestNavigation({\n          event,\n          type: treeDataTypes.end,\n          target: event.currentTarget\n        });\n      case Home:\n        return requestNavigation({\n          event,\n          type: treeDataTypes.home,\n          target: event.currentTarget\n        });\n      case ArrowUp:\n        return requestNavigation({\n          event,\n          type: treeDataTypes.arrowUp,\n          target: event.currentTarget\n        });\n      case ArrowDown:\n        return requestNavigation({\n          event,\n          type: treeDataTypes.arrowDown,\n          target: event.currentTarget\n        });\n    }\n    const isTypeAheadCharacter = event.key.length === 1 && event.key.match(/\\w/) && !event.altKey && !event.ctrlKey && !event.metaKey;\n    if (isTypeAheadCharacter) {\n      return requestNavigation({\n        event,\n        target: event.currentTarget,\n        type: treeDataTypes.typeAhead\n      });\n    }\n  });\n  const [isActionsVisible, setActionsVisible] = React.useState(false);\n  const showActions = useEventCallback(event => {\n    const isEventFromSubtree = subtreeRef.current && elementContains(subtreeRef.current, event.target);\n    if (!isEventFromSubtree) {\n      setActionsVisible(true);\n    }\n  });\n  const hideActions = useEventCallback(event => {\n    const isEventFromSubtree = subtreeRef.current && elementContains(subtreeRef.current, event.target);\n    if (!isEventFromSubtree) {\n      setActionsVisible(false);\n    }\n  });\n  // Listens to focusout event on the document to ensure treeitem actions visibility on portal scenarios\n  // TODO: find a better way to ensure this behavior\n  React.useEffect(() => {\n    if (actionsRef.current) {\n      const handleFocusOut = event => {\n        setActionsVisible(elementContains(actionsRef.current, event.relatedTarget));\n      };\n      targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.addEventListener('focusout', handleFocusOut, {\n        passive: true\n      });\n      return () => {\n        targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.removeEventListener('focusout', handleFocusOut);\n      };\n    }\n  }, [targetDocument]);\n  return {\n    isLeaf,\n    open,\n    level,\n    buttonSize: 'small',\n    isActionsVisible: actions ? isActionsVisible : false,\n    components: {\n      content: 'div',\n      root: 'div',\n      expandIcon: 'span',\n      actions: 'span',\n      subtree: 'span'\n    },\n    subtree: resolveShorthand(subtree, {\n      required: Boolean(subtreeChildren),\n      defaultProps: {\n        children: subtreeChildren,\n        ref: useMergedRefs(subtreeRef, isResolvedShorthand(subtree) ? subtree.ref : undefined)\n      }\n    }),\n    content: resolveShorthand(content, {\n      required: true,\n      defaultProps: {\n        children\n      }\n    }),\n    root: getNativeElementProps(as, {\n      tabIndex: -1,\n      ...rest,\n      id,\n      ref,\n      children: null,\n      'aria-level': level,\n      'aria-expanded': isBranch ? open : undefined,\n      role: 'treeitem',\n      onClick: handleClick,\n      onKeyDown: handleKeyDown,\n      onMouseOver: actions ? showActions : undefined,\n      onFocus: actions ? showActions : undefined,\n      onMouseOut: actions ? hideActions : undefined,\n      onBlur: actions ? hideActions : undefined\n    }),\n    expandIcon: resolveShorthand(expandIcon, {\n      required: isBranch,\n      defaultProps: {\n        children: /*#__PURE__*/React.createElement(ChevronRight12Regular, {\n          style: expandIconInlineStyles[expandIconRotation]\n        }),\n        'aria-hidden': true,\n        ref: useMergedRefs(isResolvedShorthand(expandIcon) ? expandIcon.ref : undefined, expandIconRef)\n      }\n    }),\n    actions: resolveShorthand(actions, {\n      defaultProps: {\n        ref: useMergedRefs(isResolvedShorthand(actions) ? actions.ref : undefined, actionsRef)\n      }\n    })\n  };\n};\n//# sourceMappingURL=useTreeItem.js.map"],"names":["useTreeItem_unstable","props","ref","children","subtreeChildren","React","Children","toArray","contextLevel","useTreeContext_unstable","ctx","level","content","subtree","expandIcon","leaf","isLeaf","undefined","actions","as","onClick","onKeyDown","rest","requestOpenChange","requestNavigation","id","useId","isBranch","open","openItems","has","dir","targetDocument","useFluent_unstable","expandIconRotation","actionsRef","useRef","expandIconRef","subtreeRef","handleArrowRight","event","type","treeDataTypes","arrowRight","target","currentTarget","handleArrowLeft","arrowLeft","handleEnter","enter","handleClick","useEventCallback","isEventFromActions","current","elementContains","isEventFromSubtree","isFromExpandIcon","expandIconClick","click","handleKeyDown","isDefaultPrevented","key","Enter","ArrowRight","ArrowLeft","End","end","Home","home","ArrowUp","arrowUp","ArrowDown","arrowDown","isTypeAheadCharacter","length","match","altKey","ctrlKey","metaKey","typeAhead","isActionsVisible","setActionsVisible","useState","showActions","hideActions","useEffect","handleFocusOut","relatedTarget","addEventListener","passive","removeEventListener","buttonSize","components","root","resolveShorthand","required","Boolean","defaultProps","useMergedRefs","isResolvedShorthand","getNativeElementProps","tabIndex","role","onMouseOver","onFocus","onMouseOut","onBlur","createElement","ChevronRight12Regular","style","expandIconInlineStyles"],"mappings":"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"}