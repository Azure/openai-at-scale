{"version":3,"sources":["../../lib/hooks/useVirtualizerMeasure.js"],"sourcesContent":["import * as React from 'react';\nimport { canUseDOM } from '@fluentui/react-utilities';\nimport { debounce } from '../utilities/debounce';\n/**\n * React hook that measures virtualized space based on a static size to ensure optimized virtualization length.\n */\nexport const useStaticVirtualizerMeasure = virtualizerProps => {\n  const {\n    defaultItemSize,\n    direction = 'vertical'\n  } = virtualizerProps;\n  const [state, setState] = React.useState({\n    virtualizerLength: 0,\n    bufferSize: 0,\n    bufferItems: 0\n  });\n  const {\n    virtualizerLength,\n    bufferItems,\n    bufferSize\n  } = state;\n  // The ref the user sets on their scrollView - Defaults to document.body to ensure no null on init\n  const container = React.useRef(null);\n  const resizeCallback = () => {\n    if (!container.current) {\n      return;\n    }\n    const containerSize = direction === 'vertical' ? container.current.getBoundingClientRect().height : container.current.getBoundingClientRect().width;\n    /*\n    * Number of items required to cover viewport.\n    */\n    const length = Math.ceil(containerSize / defaultItemSize + 1);\n    /*\n    * Number of items to append at each end, i.e. 'preload' each side before entering view.\n    */\n    const newBufferItems = Math.max(Math.floor(length / 4), 2);\n    /*\n    * This is how far we deviate into the bufferItems to detect a redraw.\n    */\n    const newBufferSize = Math.max(Math.floor(length / 8 * defaultItemSize), 1);\n    const totalLength = length + newBufferItems * 2 + 1;\n    setState({\n      virtualizerLength: totalLength,\n      bufferItems: newBufferItems,\n      bufferSize: newBufferSize\n    });\n  };\n  // the handler for resize observer\n  const handleResize = debounce(resizeCallback);\n  // Keep the reference of ResizeObserver in the state, as it should live through renders\n  const [resizeObserver] = React.useState(canUseDOM() ? new ResizeObserver(handleResize) : undefined);\n  React.useEffect(() => {\n    return () => {\n      resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  const scrollRef = React.useCallback(el => {\n    if (container.current !== el) {\n      if (container.current) {\n        resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.unobserve(container.current);\n      }\n      container.current = el;\n      if (container.current) {\n        resizeObserver === null || resizeObserver === void 0 ? void 0 : resizeObserver.observe(container.current);\n      }\n    }\n  }, [resizeObserver]);\n  return {\n    virtualizerLength,\n    bufferItems,\n    bufferSize,\n    scrollRef\n  };\n};\n//# sourceMappingURL=useVirtualizerMeasure.js.map"],"names":["useStaticVirtualizerMeasure","virtualizerProps","defaultItemSize","direction","state","setState","React","useState","virtualizerLength","bufferSize","bufferItems","container","useRef","resizeCallback","current","containerSize","getBoundingClientRect","height","width","length","Math","ceil","newBufferItems","max","floor","newBufferSize","totalLength","handleResize","debounce","resizeObserver","canUseDOM","ResizeObserver","undefined","useEffect","disconnect","scrollRef","useCallback","el","unobserve","observe"],"mappings":";;;;+BAMaA;;aAAAA;;;6DANU;gCACG;0BACD;AAIlB,MAAMA,8BAA8BC,CAAAA,mBAAoB;IAC7D,MAAM,EACJC,gBAAe,EACfC,WAAY,WAAU,EACvB,GAAGF;IACJ,MAAM,CAACG,OAAOC,SAAS,GAAGC,OAAMC,QAAQ,CAAC;QACvCC,mBAAmB;QACnBC,YAAY;QACZC,aAAa;IACf;IACA,MAAM,EACJF,kBAAiB,EACjBE,YAAW,EACXD,WAAU,EACX,GAAGL;IACJ,kGAAkG;IAClG,MAAMO,YAAYL,OAAMM,MAAM,CAAC,IAAI;IACnC,MAAMC,iBAAiB,IAAM;QAC3B,IAAI,CAACF,UAAUG,OAAO,EAAE;YACtB;QACF,CAAC;QACD,MAAMC,gBAAgBZ,cAAc,aAAaQ,UAAUG,OAAO,CAACE,qBAAqB,GAAGC,MAAM,GAAGN,UAAUG,OAAO,CAACE,qBAAqB,GAAGE,KAAK;QACnJ;;IAEA,GACA,MAAMC,SAASC,KAAKC,IAAI,CAACN,gBAAgBb,kBAAkB;QAC3D;;IAEA,GACA,MAAMoB,iBAAiBF,KAAKG,GAAG,CAACH,KAAKI,KAAK,CAACL,SAAS,IAAI;QACxD;;IAEA,GACA,MAAMM,gBAAgBL,KAAKG,GAAG,CAACH,KAAKI,KAAK,CAACL,SAAS,IAAIjB,kBAAkB;QACzE,MAAMwB,cAAcP,SAASG,iBAAiB,IAAI;QAClDjB,SAAS;YACPG,mBAAmBkB;YACnBhB,aAAaY;YACbb,YAAYgB;QACd;IACF;IACA,kCAAkC;IAClC,MAAME,eAAeC,IAAAA,kBAAQ,EAACf;IAC9B,uFAAuF;IACvF,MAAM,CAACgB,eAAe,GAAGvB,OAAMC,QAAQ,CAACuB,IAAAA,yBAAS,MAAK,IAAIC,eAAeJ,gBAAgBK,SAAS;IAClG1B,OAAM2B,SAAS,CAAC,IAAM;QACpB,OAAO,IAAM;YACXJ,mBAAmB,IAAI,IAAIA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAeK,UAAU,EAAE;QAC7F;IACA,uDAAuD;IACzD,GAAG,EAAE;IACL,MAAMC,YAAY7B,OAAM8B,WAAW,CAACC,CAAAA,KAAM;QACxC,IAAI1B,UAAUG,OAAO,KAAKuB,IAAI;YAC5B,IAAI1B,UAAUG,OAAO,EAAE;gBACrBe,mBAAmB,IAAI,IAAIA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAeS,SAAS,CAAC3B,UAAUG,OAAO,CAAC;YAC7G,CAAC;YACDH,UAAUG,OAAO,GAAGuB;YACpB,IAAI1B,UAAUG,OAAO,EAAE;gBACrBe,mBAAmB,IAAI,IAAIA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAeU,OAAO,CAAC5B,UAAUG,OAAO,CAAC;YAC3G,CAAC;QACH,CAAC;IACH,GAAG;QAACe;KAAe;IACnB,OAAO;QACLrB;QACAE;QACAD;QACA0B;IACF;AACF,GACA,iDAAiD"}