{"version":3,"file":"resolveResetStyleRules.esm.js","sources":["../../../../packages/core/src/runtime/resolveResetStyleRules.ts"],"sourcesContent":["import hashString from '@emotion/hash';\nimport { convert, convertProperty } from 'rtl-css-js/core';\n\nimport { RESET_HASH_PREFIX } from '../constants';\nimport { GriffelStyle, GriffelResetStyle, GriffelAnimation } from '../types';\nimport { isMediaQuerySelector } from './utils/isMediaQuerySelector';\nimport { isLayerSelector } from './utils/isLayerSelector';\nimport { isNestedSelector } from './utils/isNestedSelector';\nimport { isSupportQuerySelector } from './utils/isSupportQuerySelector';\nimport { isObject } from './utils/isObject';\nimport { hyphenateProperty } from './utils/hyphenateProperty';\nimport { compileCSSRules, normalizePseudoSelector } from './compileCSS';\nimport { compileKeyframeRule, compileKeyframesCSS } from './compileKeyframeCSS';\nimport { warnAboutUnresolvedRule } from './warnAboutUnresolvedRule';\n\n/**\n * @internal\n */\nfunction createStringFromStyles(styles: GriffelResetStyle) {\n  let ltrCSS = '';\n  let rtlCSS = '';\n\n  // eslint-disable-next-line guard-for-in\n  for (const property in styles) {\n    const value = styles[property as keyof GriffelStyle];\n\n    // eslint-disable-next-line eqeqeq\n    if (value == null) {\n      continue;\n    }\n\n    if (typeof value === 'string' || typeof value === 'number') {\n      const { key: rtlProperty, value: rtlValue } = convertProperty(property, value);\n\n      ltrCSS += `${hyphenateProperty(property)}:${value};`;\n      rtlCSS += `${hyphenateProperty(rtlProperty)}:${rtlValue};`;\n\n      continue;\n    }\n\n    if (property === 'animationName' && typeof value === 'object') {\n      const values = Array.isArray(value) ? (value as GriffelAnimation[]) : [value as GriffelAnimation];\n\n      const ltrAnimationNames: string[] = [];\n      const rtlAnimationNames: string[] = [];\n\n      for (const keyframeObject of values) {\n        const ltrKeyframeRule = compileKeyframeRule(keyframeObject);\n        const rtlKeyframeRule = compileKeyframeRule(convert(keyframeObject));\n\n        const ltrAnimationName = RESET_HASH_PREFIX + hashString(ltrKeyframeRule);\n        const rtlAnimationName = RESET_HASH_PREFIX + hashString(rtlKeyframeRule);\n\n        ltrAnimationNames.push(ltrAnimationName);\n        rtlAnimationNames.push(rtlAnimationName);\n\n        ltrCSS += compileKeyframesCSS(ltrAnimationName, ltrKeyframeRule).join('');\n\n        if (ltrAnimationName !== rtlAnimationName) {\n          rtlCSS += compileKeyframesCSS(rtlAnimationName, rtlKeyframeRule).join('');\n        }\n      }\n\n      ltrCSS += `animation-name:${ltrAnimationNames.join(',')};`;\n      rtlCSS += `animation-name:${rtlAnimationNames.join(',')};`;\n\n      continue;\n    }\n\n    if (Array.isArray(value)) {\n      // not animationName property but array in the value => fallback values\n      if (value.length === 0) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `makeResetStyles(): An empty array was passed as input to \"${property}\", the property will be omitted in the styles.`,\n          );\n        }\n        continue;\n      }\n\n      const rtlDefinitions = value.map(v => convertProperty(property, v!));\n      const rtlPropertyConsistent = !rtlDefinitions.some(v => v.key !== rtlDefinitions[0].key);\n\n      if (!rtlPropertyConsistent) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.error(\n            'makeStyles(): mixing CSS fallback values which result in multiple CSS properties in RTL is not supported.',\n          );\n        }\n        continue;\n      }\n\n      const rtlProperty = rtlDefinitions[0].key;\n\n      ltrCSS += value.map(v => `${hyphenateProperty(property)}:${v};`).join('');\n      rtlCSS += rtlDefinitions.map(definition => `${hyphenateProperty(rtlProperty)}:${definition.value};`).join('');\n\n      continue;\n    }\n\n    if (isObject(value)) {\n      if (isNestedSelector(property)) {\n        const nestedSelector = normalizePseudoSelector(property);\n        const [ltrNested, rtlNested] = createStringFromStyles(value);\n\n        ltrCSS += `${nestedSelector}{${ltrNested}}`;\n        rtlCSS += `${nestedSelector}{${rtlNested}}`;\n\n        continue;\n      }\n\n      if (isMediaQuerySelector(property) || isLayerSelector(property) || isSupportQuerySelector(property)) {\n        const [ltrNested, rtlNested] = createStringFromStyles(value);\n\n        ltrCSS += `${property}{${ltrNested}}`;\n        rtlCSS += `${property}{${rtlNested}}`;\n\n        continue;\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      warnAboutUnresolvedRule(property, value);\n    }\n  }\n\n  return [ltrCSS, rtlCSS];\n}\n\n/**\n * @internal\n */\nexport function resolveResetStyleRules(styles: GriffelResetStyle): [string, string | null, string[]] {\n  const [ltrRule, rtlRule] = createStringFromStyles(styles);\n\n  const ltrClassName = RESET_HASH_PREFIX + hashString(ltrRule);\n  const ltrCSS = compileCSSRules(`.${ltrClassName}{${ltrRule}}`);\n\n  if (ltrRule === rtlRule) {\n    return [ltrClassName, null, ltrCSS];\n  }\n\n  const rtlClassName = RESET_HASH_PREFIX + hashString(rtlRule);\n  const rtlCSS = compileCSSRules(`.${rtlClassName}{${rtlRule}}`);\n\n  return [ltrClassName, rtlClassName, ltrCSS.concat(rtlCSS)];\n}\n"],"names":["createStringFromStyles","styles","ltrCSS","rtlCSS","property","value","key","rtlProperty","rtlValue","convertProperty","hyphenateProperty","values","Array","isArray","ltrAnimationNames","rtlAnimationNames","keyframeObject","ltrKeyframeRule","compileKeyframeRule","rtlKeyframeRule","convert","ltrAnimationName","RESET_HASH_PREFIX","hashString","rtlAnimationName","push","compileKeyframesCSS","join","length","process","env","NODE_ENV","console","warn","rtlDefinitions","map","v","rtlPropertyConsistent","some","error","definition","isObject","isNestedSelector","nestedSelector","normalizePseudoSelector","ltrNested","rtlNested","isMediaQuerySelector","isLayerSelector","isSupportQuerySelector","warnAboutUnresolvedRule","resolveResetStyleRules","ltrRule","rtlRule","ltrClassName","compileCSSRules","rtlClassName","concat"],"mappings":"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"}